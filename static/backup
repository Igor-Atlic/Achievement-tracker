<!DOCTYPE html>
<html lang=en>
    <head>
        <title>SJ Vezbe</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script src="skripta.js"></script>
    </head>
    <body onload="init()">
        <div class="container">
            <div class="col-6">
                <button type="button" id="logout" class="btn btn-primary">Log Out</button>
                <h3 id="currentUser"></h3>
            </div>
            <div class="row">
                <div class="col">
                    <form method="post" action="/api/user">
                        <div class="mb-3">
                            <label for="usernameU" class="form-label">Username</label>
                            <input type="text" class="form-control" id="usernameU" name="usernameU">
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password">
                        </div>
                        <div class="mb-3">
                            <label for="permission" class="form-label">Permission</label>
                            <input type="text" class="form-control" id="permission" name="permission">
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="email" name="email" aria-describedby="emailHelp">
                            <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="userBtn">Submit</button>
                    </form>
                </div>
                <div class="col-6">
                    <h2>Users:</h2>
                    <ul id="userLst"></ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="container">
            <div class="row">
                <div class="col">
                    <form method="post" action="/api/game">
                        <div class="mb-3">
                            <label for="userIdG" class="form-label">userId</label>
                            <input type="text" class="form-control" id="userIdG" name="userIdG">
                        </div>
                        <div class="mb-3">
                            <label for="nameG" class="form-label">Name</label>
                            <input type="text" class="form-control" id="nameG" name="nameG">
                        </div>
                        <button type="submit" class="btn btn-primary" id="gameBtn">Submit</button>
                    </form>
                </div>
                <div class="col-6">
                    <h2>Game:</h2>
                    <ul id="gameList"></ul>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <form method="post" action="/api/achievement">
                        <div class="mb-3">
                            <label for="nameA" class="form-label">Name</label>
                            <input type="text" class="form-control" id="nameA" name="nameA">
                        </div>
                        <div class="mb-3">
                            <label for="gameIdA" class="form-label">Game ID</label>
                            <input type="text" class="form-control" id="gameIdA" name="gameIdA">
                        </div>
                        <div class="mb-3">
                            <label for="textA" class="form-label">Text</label>
                            <textarea class="form-control" id="textA" name="textA" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="finished" class="form-label">Finished</label>
                            <input type="text" class="form-control" id="finished" name="finished">
                        </div>
                        <button type="submit" class="btn btn-primary" id="achievementBtn">Submit</button>
                    </form>
                </div>
                <div class="col-6">
                    <h2>Achievement:</h2>
                    <ul id="achievementList"></ul>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col">
                    <form method="post" action="/api/comment">
                        <div class="mb-3">
                            <label for="userIdC" class="form-label">userId</label>
                            <input type="text" class="form-control" id="userIdC" name="userIdC">
                        </div>
                        <div class="mb-3">
                            <label for="achievementIdC" class="form-label">achievementId</label>
                            <input type="text" class="form-control" id="achievementIdC" name="achievementIdC">
                        </div>
                        <div class="mb-3">
                            <label for="textC" class="form-label">Text</label>
                            <textarea class="form-control" id="textC" name="textC" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="categoryC" class="form-label">category</label>
                            <input type="text" class="form-control" id="categoryC" name="categoryC">
                        </div>
                        <button type="submit" class="btn btn-primary" id="commentBtn">Submit</button>
                    </form>
                </div>
                <div class="col-6">
                    <h2>Comments:</h2>
                    <ul id="commentList"></ul>
                </div>
            </div>
        </div>
    </body>
</html>



function init() {
    
    const cookies = document.cookie.split('=');
    const token = cookies[cookies.length - 1];


    fetch('http://192.168.1.23:8000/api/currentUser',{
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
        .then( res => res.json() )
        .then( data => {
            const lst = document.getElementById('currentUser').innerHTML = `Username ${data.username}`;

            
        });

    fetch('http://192.168.1.23:8000/api/users',{
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
        .then( res => res.json() )
        .then( data => {
            const lst = document.getElementById('userLst');

            data.forEach( el => {
                lst.innerHTML += `<li>ID: ${el.id}, Username: ${el.username}, E-mail: ${el.email}, Password: ${el.password}, Permission: ${el.permission}</li>`;
            });
        });

    fetch('http://192.168.1.23:8000/api/games',{
        headers: {
        'Authorization': `Bearer ${token}`
    }})
        .then( res => res.json() )
        .then( data => {
            const lst = document.getElementById('gameList');

            data.forEach( el => {
                lst.innerHTML += `<li>ID: ${el.id}, Name: ${el.name}, Developer: ${el.developer.username}</li>`;
            });
        });

    fetch('http://192.168.1.23:8000/api/achievements',{
        headers: {
        'Authorization': `Bearer ${token}`
    }})
    .then( res => res.json() )
    .then( data => {
        const lst = document.getElementById('achievementList');

        data.forEach( el => {
            lst.innerHTML += `<li>ID: ${el.id}, Name: ${el.name}, Game ID: ${el.game.name}</li>, Text: ${el.text}</li>, Finished: ${el.finished} `;
        });
    });

    fetch('http://192.168.1.23:8000/api/comments',{
        headers: {
        'Authorization': `Bearer ${token}`
    }})
    .then( res => res.json() )
    .then( data => {
        const lst = document.getElementById('commentList');

        data.forEach( el => {
            lst.innerHTML += `<li>ID: ${el.id}, Name: ${el.user.username}, User ID: ${el.user.id}</li>, Achievement ID: ${el.achievement.id}</li>,Text: ${el.text}</li>, Category: ${el.category} `;
        });
    });
    document.getElementById('userBtn').addEventListener('click', e => {
        e.preventDefault();

        const data = {
            username: document.getElementById('usernameU').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value,
            permission: document.getElementById('permission').value
        };

        document.getElementById('usernameU').value = '',
        document.getElementById('email').value = '',
        document.getElementById('password').value = '',
        document.getElementById('permission').value = ''

        fetch('http://192.168.1.23:8000/api/user', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}` },
            body: JSON.stringify(data)
        })
            .then( res => res.json() )
            .then( el => {
                document.getElementById('userLst').innerHTML += `<li>ID: ${el.id}, Username: ${el.username}, E-mail: ${el.email}, Password: ${el.password}, Permission: ${el.permission}</li>`;
            });
    });

    document.getElementById('gameBtn').addEventListener('click', e => {
        e.preventDefault();
        
        const data = {
            name: document.getElementById('nameG').value,
            userId: document.getElementById('userIdG').value
        };

        document.getElementById('nameG').value = '';
        document.getElementById('userIdG').value = '';

        fetch('http://192.168.1.23:8000/api/game', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' ,
            'Authorization': `Bearer ${token}`},
            body: JSON.stringify(data)
        })
            .then( res => res.json() )
            .then( el => {
                document.getElementById('gameList').innerHTML += `<li>ID: ${el.id}, Name: ${el.name}, Developer Id: ${el.userId}</li>`;
            });
    });

    document.getElementById('achievementBtn').addEventListener('click', e => {
        e.preventDefault();
        
        const data = {
            name: document.getElementById('nameA').value,
            gameId: document.getElementById('gameIdA').value,
            text:document.getElementById('textA').value,
            finished:document.getElementById('finished').value
        };

        document.getElementById('nameA').value = '';
        document.getElementById('gameIdA').value = '';
        document.getElementById('textA').value = '',
        document.getElementById('finished').value = ''

        fetch('http://192.168.1.23:8000/api/achievement', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' ,
            'Authorization': `Bearer ${token}`},
            body: JSON.stringify(data)
        })
            .then( res => res.json() )
            .then( el => {
                document.getElementById('achievementList').innerHTML += `<li>ID: ${el.id}, Name: ${el.name}, Game ID: ${el.game.id}</li>, Text: ${el.text}</li>, Finished: ${el.finished} `;
            });
    });

    document.getElementById('commentBtn').addEventListener('click', e => {
        e.preventDefault();
        
        const data = {
            achievementId: document.getElementById('achievementIdC').value,
            userId: document.getElementById('userIdC').value,
            text: document.getElementById('textC').value,
            category: document.getElementById('categoryC').value
        };

        document.getElementById('achievementIdC').value = '';
        document.getElementById('userIdC').value = '';
        document.getElementById('textC').value = '';
        document.getElementById('categoryC').value = '';

        fetch('http://192.168.1.23:8000/api/comment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' ,
            'Authorization': `Bearer ${token}`},
            body: JSON.stringify(data)
        })
            .then( res => res.json() )
            .then( el => {
                document.getElementById('commentList').innerHTML += `<li>ID: ${el.id}, User ID: ${el.userId}</li>, Achievement ID: ${el.achievementId}</li>,Text: ${el.text}</li>, Category: ${el.category} `;
            });
    });

    document.getElementById('logout').addEventListener('click', e => {
        document.cookie = `token=;SameSite=Lax`;
        window.location.href = 'login.html';
    });
}